<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Panel de Administraci√≥n</title>
  <link rel="stylesheet" href="../css/global.css" />
  <link rel="stylesheet" href="../css/navbar.css" />
  <link rel="stylesheet" href="../css/admin.css" />
</head>

<body>
  <div class="container">
    
    <!-- ‚úÖ INICIO: BLOQUE DE CARGA S√çNCRONA CON DIAGN√ìSTICO AVANZADO -->
    <!-- ‚úÖ INICIO: BLOQUE DE CARGA S√çNCRONA (VERSI√ìN FINAL) -->
<aside id="sidebar-placeholder" class="sidebar"></aside>

    <script>
      (function () {
        const placeholder = document.getElementById('sidebar-placeholder');
        if (placeholder) {
          try {
            const request = new XMLHttpRequest();
            request.open('GET', '_sidebar.html', false); // S√≠ncrono
            request.send(null);
            if (request.status === 200 || request.status === 0) {
              placeholder.innerHTML = request.responseText;
            } else {
              placeholder.innerHTML = '<p style="color:red;">Error al cargar men√∫.</p>';
            }
          } catch (error) {
            console.error("Error cargando sidebar:", error);
          }
        }
      })();
    </script>
    <!-- ‚úÖ FIN: BLOQUE DE CARGA S√çNCRONA -->
    <!-- ‚úÖ FIN: BLOQUE DE CARGA S√çNCRONA -->
    <main class="main-content">
      <header class="main-header">
        <h1>Panel de Administraci√≥n</h1>
      </header>
<!-- üîî Banner Premium -->
<div id="premium-banner" class="banner banner-info hidden">
  <div class="banner-text">
    <strong>Plan Free:</strong> activ√° las funciones premium (backup en la nube, multi-equipo, estad√≠sticas online).
  </div>
  <button id="close-premium-banner" class="banner-close" aria-label="Cerrar">√ó</button>
</div>

      <div class="content-body">

        <!-- Secci√≥n de Gesti√≥n de Usuario -->
        <section class="content-section">
          <div class="section-header">
            <h2>Gesti√≥n de Usuario</h2>
            <button id="btn-nuevo-Usuario" class="btn btn-primario">
              + Nuevo Usuario
            </button>
          </div>
          <div class="table-container">
            <table id="users-table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Rol</th>
                  <th style="text-align: right;">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <!-- Las filas se generar√°n con JS -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- ==================================================================== -->
        <!-- SECCI√ìN GESTI√ìN DE EMPLEADOS                                     -->
        <!-- ==================================================================== -->
        <section class="content-section">
          <details class="tutorial">
            <summary>Aclaraci√≥n sobre la Gesti√≥n de Empleados</summary>
            <div class="tutorial-content">
              <p>Esta secci√≥n te permite llevar un registro b√°sico de tus empleados, sus funciones y sueldos. Esta
                informaci√≥n es para control interno y puede ser utilizada en futuros reportes de rentabilidad.</p>
            </div>
          </details>
          <div class="section-header">
            <h2>Gesti√≥n de Empleados</h2>
            <button id="btn-nuevo-empleado" class="btn btn-primario">Nuevo Empleado</button>
          </div>
          <div id="empleados-container" class="grid-container">
            <!-- Las tarjetas de empleados se cargar√°n aqu√≠ -->
          </div>
        </section>

        <!-- ==================================================================== -->
        <!-- SECCI√ìN GASTOS FIJOS                                             -->
        <!-- ==================================================================== -->
        <section class="content-section">
          <details class="tutorial">
            <summary>Aclaraci√≥n sobre los Gastos Fijos</summary>
            <div class="tutorial-content">
              <p>Registra aqu√≠ todos tus gastos mensuales recurrentes. Esto es fundamental para que el sistema pueda
                calcular la rentabilidad neta de tu negocio en los reportes del Dashboard.</p>
              <ul>
                <li>Ingresa un nombre descriptivo (ej: "Alquiler Local", "Luz EPEC").</li>
                <li>Ingresa el monto mensual estimado o exacto.</li>
              </ul>
            </div>
          </details>
          <h2>Gastos Fijos Mensuales</h2>
          <div id="gastos-fijos-container">
            <!-- La lista de gastos se cargar√° aqu√≠ -->
          </div>
          <form id="gasto-fijo-form" class="inline-form">
            <input type="text" id="gasto-nombre" placeholder="Nombre del Gasto (ej: Luz)" required>
            <input type="number" id="gasto-monto" placeholder="Monto Mensual" step="0.01" required>
            <button type="submit" class="btn btn-secundario">Agregar Gasto</button>
          </form>
        </section>

        <!-- ==================================================================== -->
        <!-- SECCI√ìN M√ìDULOS ADICIONALES                                      -->
        <!-- ==================================================================== -->
        <section class="content-section">
          <h2>M√≥dulos Adicionales</h2>
          <div class="module-toggle">
            <label for="facturacion-toggle">M√≥dulo de Facturaci√≥n AFIP</label>
            <!-- üü¢ CAMBIO: Se usa un checkbox estilizado -->
            <div class="checkbox-control">
              <input type="checkbox" id="facturacion-toggle">
              <label for="facturacion-toggle"></label>
            </div>
          </div>
        </section>

        <!-- Secci√≥n de Informaci√≥n del Negocio -->
        <section class="content-section">
          <h2>Informaci√≥n del Negocio y Ticket</h2>
          <form id="business-info-form">
            <div class="form-grid-2">
              <div>
                <div class="form-campo">
                  <label for="business-name">Nombre del Negocio</label>
                  <input type="text" id="business-name" placeholder="Mi Tienda" />
                </div>
                <div class="form-campo">
                  <label for="business-slogan">Slogan o Mensaje secundario</label>
                  <input type="text" id="business-slogan" placeholder="Calidad y buen precio" />
                </div>
                <div class="form-campo">
                  <label for="ticket-footer">Mensaje al pie del Ticket</label>
                  <textarea id="ticket-footer" rows="3" placeholder="¬°Gracias por su compra!"></textarea>
                </div>
                <div class="form-campo">
                  <label for="logo-upload">Logotipo del Negocio (PNG o JPG)</label>
                  <input type="file" id="logo-upload" accept="image/png, image/jpeg" />
                </div>
              </div>
              <div class="ticket-preview-container">
                <h4>Vista Previa del Ticket</h4>
                <div class="ticket-preview">
                  <div class="ticket-header">
                    <img id="preview-logo" src="" alt="Logo" style="display: none" />
                    <div id="preview-name" class="ticket-business-name">Nombre del Negocio</div>
                    <div id="preview-slogan" class="ticket-slogan">Slogan del Negocio</div>
                  </div>
                  <div class="ticket-body">
                    <p>--------------------------------</p>
                    <p>PRODUCTO EJEMPLO</p>
                    <p>1 x $1500.00 = $1500.00</p>
                    <p>--------------------------------</p>
                    <p class="ticket-total">TOTAL: $1500.00</p>
                  </div>
                  <div id="preview-footer" class="ticket-footer">¬°Gracias por su compra!</div>
                </div>
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primario">Guardar Informaci√≥n</button>
            </div>
          </form>
        </section>

        <!-- Secci√≥n de Hardware -->
        <!-- ==================================================================== -->
        <!-- SECCI√ìN HARDWARE Y PERIF√âRICOS (CON TUTORIAL)                      -->
        <!-- ==================================================================== -->
        <section class="content-section">
          <h2>Hardware y Perif√©ricos</h2>

          <!-- ‚úÖ INICIO: TUTORIAL A√ëADIDO -->
          <details class="tutorial">
            <summary><strong>GU√çA:</strong> ¬øEl esc√°ner o la impresora no funcionan?</summary>
            <div class="tutorial-content">
              <p>Configurar el hardware correctamente es clave. Sigue estos pasos si encuentras problemas.</p>

              <h4>Configuraci√≥n del Esc√°ner de C√≥digos de Barras</h4>
              <ol>
                <li><strong>Modo Emulaci√≥n de Teclado (Keyboard Wedge):</strong> La mayor√≠a de los esc√°neres USB
                  funcionan "de caja" simulando ser un teclado. Si tu esc√°ner no escribe el c√≥digo en un bloc de notas,
                  es probable que no est√© en este modo.</li>
                <li><strong>Configuraci√≥n Inicial:</strong> A veces, el lector de c√≥digos de barras necesita una
                  configuraci√≥n inicial para funcionar correctamente (ej: para leer ciertos tipos de c√≥digos, a√±adir un
                  "Enter" al final, etc.).</li>
                <li>
                  <strong>¬øC√≥mo se configura?:</strong> Esta configuraci√≥n se realiza escaneando una serie de c√≥digos de
                  barras especiales que vienen en el <strong>manual de usuario</strong> del dispositivo.
                  <ul>
                    <li>Busca el manual f√≠sico que vino con tu esc√°ner.</li>
                    <li>Si no lo tienes, busca en internet el manual en PDF con el <strong>nombre completo, marca y
                        modelo</strong> de tu lector (ej: "Manual PDF Symbol LS2208").</li>
                    <li>Dentro del manual, busca secciones como "Configuraci√≥n de Interfaz", "Interface Settings" o
                      "Suffix Settings" para encontrar los c√≥digos de barras de configuraci√≥n.</li>
                  </ul>
                </li>
              </ol>

              <h4>Configuraci√≥n de la Impresora de Tickets (Ticketera)</h4>
              <ol>
                <li><strong>Instalar los Drivers:</strong> Este es el paso m√°s importante. Antes de que el sistema pueda
                  ver la impresora, debes instalar el software (drivers) que el fabricante proporciona.
                  <ul>
                    <li>Busca en internet "drivers para [Marca y Modelo de tu impresora]" (ej: "drivers Epson
                      TM-T20II").</li>
                    <li>Descarga el instalador desde la p√°gina oficial del fabricante y ejec√∫talo.</li>
                  </ul>
                </li>
                <li><strong>Reiniciar la PC:</strong> Despu√©s de instalar los drivers, es <strong>muy importante
                    reiniciar tu computadora</strong> para que los cambios se apliquen correctamente.</li>
                <li><strong>Seleccionar en el Sistema:</strong> Una vez reiniciada la PC, vuelve a esta pantalla, haz
                  clic en el bot√≥n <strong>"Refrescar Puertos"</strong> y tu impresora deber√≠a aparecer en la lista
                  desplegable "Impresora de Tickets".</li>
                <li><strong>Guardar la Selecci√≥n:</strong> No olvides seleccionarla en la lista y hacer clic en
                  <strong>"Guardar Hardware"</strong>.
                </li>
              </ol>
            </div>
          </details>
          <!-- ‚úÖ FIN: TUTORIAL A√ëADIDO -->

          <form id="hardware-config-form">
            <div class="form-grid-2">
              <div class="form-campo">
                <label for="scanner-port">Puerto del Esc√°ner de C√≥digos</label>
                <select id="scanner-port">
                  <option value="">-- No seleccionado --</option>
                </select>
                <small>Generalmente no es necesario para esc√°neres USB que emulan un teclado.</small>
              </div>
              <div class="form-campo">
                <label for="printer-name">Impresora de Tickets</label>
                <select id="printer-name">
                  <option value="">-- No seleccionada --</option>
                </select>
                <small>Aseg√∫rate de haber instalado los drivers primero.</small>
              </div>
            </div>
            <div class="form-actions">
              <!-- ‚úÖ NUEVO BOT√ìN DE PRUEBA A√ëADIDO -->
              <button type="button" id="btn-test-print" class="btn btn-warning">Imprimir P√°gina de Prueba</button>
              <button type="button" id="btn-refresh-ports" class="btn btn-secundario">Refrescar Puertos</button>
              <button type="submit" class="btn btn-primario">Guardar Hardware</button>
            </div>
          </form>
        </section>

        <!-- Secci√≥n de Par√°metros Financieros -->
        <section class="content-section">
          <h2>Par√°metros Financieros</h2>
          <form id="general-config-form">
            <div class="form-grid-2">
              <div class="form-campo">
                <label for="recargo-credito">Recargo por Pago con Cr√©dito (%)</label>
                <input type="number" step="0.01" id="recargo-credito" placeholder="Ej: 15" />
                <small>Ingresa el porcentaje sin el s√≠mbolo %. Ej: 15 para 15%.</small>
              </div>
              <div class="form-campo">
                <label for="descuento-efectivo">Descuento por Pago en Efectivo (%)</label>
                <input type="number" step="0.01" id="descuento-efectivo" placeholder="Ej: 10" />
                <small>Este descuento se suma al del cliente.</small>
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primario">Guardar Par√°metros</button>
            </div>
          </form>
        </section>

        <!-- En: admin.html -->
        <!-- ==================================================================== -->
        <!-- SECCI√ìN MERCADO PAGO (CON TUTORIAL FINAL PARA USUARIO)               -->
        <!-- ==================================================================== -->
        <section class="content-section">
          <h2>Credenciales de Mercado Pago</h2>
          <form id="mp-config-form">

            <details class="tutorial">
              <summary><strong>GU√çA PASO A PASO:</strong> ¬øC√≥mo obtener mis credenciales?</summary>
              <div class="tutorial-content">
                <p>Configurar Mercado Pago es un proceso que se hace una sola vez. Sigue estos pasos con atenci√≥n.</p>

                <h4>Paso 1: Obtener Credenciales B√°sicas</h4>
                <ol>
                  <li>Haz clic aqu√≠ para ir al <a href="https://www.mercadopago.com.ar/developers/panel/app/list"
                      target="_blank">Panel de Desarrolladores de Mercado Pago</a> e inicia sesi√≥n.</li>
                  <li>Haz clic en <strong>"Crear aplicaci√≥n"</strong>. Dale un nombre (ej: "Mi Sistema TPV La
                    Macelleria") y acepta los t√©rminos.</li>
                  <li>Dentro de tu nueva aplicaci√≥n, ve a la secci√≥n <strong>"Credenciales de Producci√≥n"</strong> y
                    act√≠valas.</li>
                  <li>Copia los siguientes dos datos y p√©galos en los campos de abajo:
                    <ul>
                      <li>El <strong>Access Token</strong> (empieza con <code>APP_USR-...</code>)</li>
                      <li>El <strong>User ID</strong> (un n√∫mero largo, es tu ID de vendedor)</li>
                    </ul>
                  </li>
                </ol>

                <h4>Paso 2: Activar Permisos de la API (¬°Muy Importante!)</h4>
                <ol>
                  <li>En la misma p√°gina de tu aplicaci√≥n, busca la secci√≥n "Detalles de aplicaci√≥n" y haz clic en el
                    bot√≥n azul <strong>"Editar"</strong>.</li>
                  <li>Despl√°zate hacia abajo hasta encontrar la secci√≥n <strong>"Permisos de la aplicaci√≥n"</strong>.
                  </li>
                  <li>Marca las casillas de los siguientes permisos. Son necesarios para que el sistema pueda crear y
                    gestionar cobros:
                    <ul>
                      <li>‚úÖ <code>write_stores</code> (para administrar tiendas)</li>
                      <li>‚úÖ <code>pos_write</code> (para administrar cajas)</li>
                      <li>‚úÖ <code>offline_access</code> (para que la conexi√≥n no expire)</li>
                      <li>‚úÖ <code>payments</code> (para gestionar pagos)</li>
                    </ul>
                  </li>
                  <li>Al final de la p√°gina, haz clic en el bot√≥n <strong>"Guardar cambios"</strong>.</li>
                </ol>

                <h4>Paso 3: Renovar Token y Cargar Cajas</h4>
                <ol>
                  <li>Vuelve a la pesta√±a de <strong>"Credenciales de Producci√≥n"</strong>.</li>
                  <li>Haz clic en el bot√≥n <strong>"Renovar mis credenciales"</strong>. Esto es
                    <strong>obligatorio</strong> para que tu Access Token obtenga los nuevos permisos.
                  </li>
                  <li>Copia el <strong>NUEVO</strong> Access Token que aparecer√° y p√©galo de nuevo en el campo "Access
                    Token" de abajo, reemplazando el viejo.</li>
                  <li>Con las credenciales actualizadas, haz clic en el bot√≥n de abajo que dice <strong>"Verificar y
                      Cargar Cajas"</strong>. El sistema se conectar√° a Mercado Pago y listar√° tus cajas disponibles.
                  </li>
                </ol>

                <h4>Paso 4: Guardar Configuraci√≥n Final</h4>
                <ol>
                  <li>Una vez cargadas, <strong>selecciona la caja</strong> que deseas usar en este sistema desde el
                    men√∫ desplegable.</li>
                  <li>Finalmente, haz clic en el bot√≥n <strong>"Guardar Credenciales MP"</strong>.</li>
                </ol>
                <p><strong>¬°Listo!</strong> Tu sistema ya est√° configurado para recibir pagos con QR.</p>
              </div>
            </details>

            <div class="form-campo">
              <label for="mp-access-token">Access Token</label>
              <input type="password" id="mp-access-token" placeholder="P√©galo aqu√≠ desde el Paso 1" />
            </div>
            <div class="form-campo">
              <label for="mp-user-id">User ID</label>
              <input type="text" id="mp-user-id" placeholder="P√©galo aqu√≠ desde el Paso 1" />
            </div>

            <div class="form-actions" style="justify-content: flex-start; margin-bottom: 1rem;">
              <button type="button" id="btn-verify-mp" class="btn btn-secundario">Verificar y Cargar Cajas</button>
            </div>

            <div class="form-campo">
              <label for="mp-pos-id">Caja (Punto de Venta)</label>
              <select id="mp-pos-id" required>
                <option value="">-- Completa los pasos anteriores --</option>
              </select>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primario">Guardar Credenciales MP</button>
            </div>
          </form>
        </section>

        <!-- Secci√≥n de Balanza -->
        <section class="content-section">
          <h2>Formato de C√≥digo de Barras (Balanza)</h2>
          <form id="balanza-config-form">
            <p class="form-description">
              Usa esta herramienta visual para ense√±arle al sistema c√≥mo leer los c√≥digos de barras de tus productos
              pesables.
            </p>
            <div class="visualizador-container">
              <label>Visualizador de Formato:</label>
              <div id="formato-visualizador" class="formato-visualizador">
                <span id="vis-prefijo" class="parte-prefijo">20</span>
                <span id="vis-codigo" class="parte-codigo">CCCCC</span>
                <span id="vis-valor" class="parte-valor">VVVVV</span>
                <span id="vis-digito" class="parte-digito">D</span>
              </div>
              <div class="visualizador-leyenda">
                <div><span class="leyenda-caja parte-prefijo"></span> Prefijo</div>
                <div><span class="leyenda-caja parte-codigo"></span> C√≥digo Producto (PLU)</div>
                <div><span class="leyenda-caja parte-valor"></span> Valor (Peso/Precio)</div>
                <div><span class="leyenda-caja parte-digito"></span> D√≠gito Verificador</div>
              </div>
              <div id="visualizador-resultado" class="visualizador-resultado"></div>
            </div>
            <div class="form-grid-3">
              <div class="form-campo">
                <label for="balanza-prefijo">1. Prefijo del C√≥digo</label>
                <input type="text" id="balanza-prefijo" placeholder="Ej: 20" />
                <small>Los primeros d√≠gitos que identifican un c√≥digo de balanza.</small>
              </div>
              <div class="form-campo">
                <label for="balanza-tipo-valor">2. ¬øQu√© representa el Valor?</label>
                <select id="balanza-tipo-valor">
                  <option value="peso">El Peso del producto</option>
                  <option value="precio">El Precio final del producto</option>
                </select>
                <small>Elige si el c√≥digo contiene el peso o el precio.</small>
              </div>
              <div class="form-campo">
                <label for="balanza-valor-divisor">3. Divisor del Valor</label>
                <input type="number" id="balanza-valor-divisor" readonly />
                <small>Se ajusta autom√°ticamente seg√∫n el tipo de valor.</small>
              </div>
            </div>
            <div class="form-grid-2">
              <fieldset>
                <legend>4. Parte del C√≥digo de Producto</legend>
                <div class="form-campo">
                  <label>Posici√≥n de Inicio</label>
                  <input type="number" id="balanza-codigo-inicio" placeholder="Ej: 3" />
                </div>
                <div class="form-campo">
                  <label>N¬∫ de d√≠gitos (Longitud)</label>
                  <input type="number" id="balanza-codigo-longitud" placeholder="Ej: 5" />
                </div>
              </fieldset>
              <fieldset>
                <legend>5. Parte del Valor</legend>
                <div class="form-campo">
                  <label>Posici√≥n de Inicio</label>
                  <input type="number" id="balanza-valor-inicio" placeholder="Ej: 8" />
                </div>
                <div class="form-campo">
                  <label>N¬∫ de d√≠gitos (Longitud)</label>
                  <input type="number" id="balanza-valor-longitud" placeholder="Ej: 5" />
                </div>
              </fieldset>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primario">Guardar Configuraci√≥n de Balanza</button>
            </div>
          </form>
        </section>
        <!-- ==================================================================== -->
        <!-- üü¢ INICIO: SECCI√ìN CONFIGURACI√ìN AFIP                               -->
        <!-- ==================================================================== -->
        <section id="afip-section" class="content-section">
          <h2>Configuraci√≥n de Facturaci√≥n AFIP</h2>
          <form id="afip-config-form">
            <details class="tutorial">
              <summary>¬øC√≥mo obtengo los archivos de Certificado y Clave?</summary>
              <div class="tutorial-content">
                <p>Para facturar electr√≥nicamente, necesitas un <strong>Certificado Digital</strong> y una <strong>Clave
                    Privada</strong> generados para tu CUIT. Este es un proceso t√©cnico que generalmente realiza un
                  contador o t√∫ mismo siguiendo una gu√≠a oficial de AFIP.</p>
                <h4>Pasos Generales:</h4>
                <ol>
                  <li><strong>Generar Clave Privada y CSR:</strong> Usando una herramienta como OpenSSL, se genera un
                    archivo <code>private.key</code> (tu clave, ¬°gu√°rdala bien!) y un <code>request.csr</code> (una
                    solicitud).</li>
                  <li><strong>Enviar CSR a AFIP:</strong> Desde el portal de AFIP con tu Clave Fiscal, en el servicio
                    "Administrador de Certificados Digitales", env√≠as el archivo <code>request.csr</code>.</li>
                  <li><strong>Descargar Certificado de AFIP:</strong> AFIP te devolver√° un archivo de certificado,
                    generalmente con extensi√≥n <code>.crt</code>.</li>
                </ol>
                <p>Una vez que tengas los archivos <code>private.key</code> y <code>nombre_de_tu_empresa.crt</code>,
                  debes seleccionarlos en los campos de abajo.</p>
              </div>
            </details>

            <div class="form-grid-2">
              <div class="form-campo">
                <label for="afip-cuit">CUIT del Emisor</label>
                <input type="number" id="afip-cuit" placeholder="Ej: 20123456789" required />
                <small>Ingresa el CUIT sin guiones.</small>
              </div>
              <div class="form-campo">
                <label for="afip-pto-vta">Punto de Venta</label>
                <input type="number" id="afip-pto-vta" placeholder="Ej: 1" required />
                <small>El n√∫mero de punto de venta que dar√°s de alta en AFIP.</small>
              </div>
            </div>

            <div class="form-grid-2">
              <div class="form-campo">
                <label for="afip-cert-file">Archivo de Certificado (.crt)</label>
                <input type="file" id="afip-cert-file" accept=".crt">
                <span id="cert-file-path" class="file-path-display">No seleccionado</span>
              </div>
              <div class="form-campo">
                <label for="afip-key-file">Archivo de Clave Privada (.key)</label>
                <input type="file" id="afip-key-file" accept=".key">
                <span id="key-file-path" class="file-path-display">No seleccionado</span>
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primario">Guardar Configuraci√≥n AFIP</button>
            </div>
          </form>
        </section>

        <!-- ‚úÖ INICIO: SECCI√ìN GESTI√ìN DE CAJA (MODIFICADA) -->
        <section class="content-section">
          <h2>Gesti√≥n de Caja (Arqueo)</h2>
          <form id="arqueo-config-form">
            <details class="tutorial">
              <summary>¬øC√≥mo funciona el Arqueo de Caja?</summary>
              <div class="tutorial-content">
                <p>Al habilitar esta opci√≥n, el sistema requerir√° que un cajero realice una "Apertura de Caja" antes de
                  poder registrar ventas. En ese momento, deber√° ingresar el monto de dinero inicial (cambio).</p>
                <p>Al final del turno, el cajero deber√° realizar un "Cierre de Caja", donde el sistema calcular√° los
                  totales y permitir√° imprimir un resumen detallado del turno (arqueo).</p>
                <p>Los horarios de los turnos son informativos y pueden usarse en el futuro para recordatorios
                  autom√°ticos.</p>
              </div>
            </details>
            <div class="module-toggle">
              <label for="arqueo-toggle">Habilitar Apertura y Cierre de Caja</label>
              <div class="checkbox-control">
                <input type="checkbox" id="arqueo-toggle">
                <label for="arqueo-toggle"></label>
              </div>
            </div>

            <div id="horarios-arqueo-container" style="display: none; margin-top: 1.5rem;"> <!-- Inicia oculto -->
              <fieldset>
                <legend>Turno Ma√±ana</legend>
                <div class="form-grid-2">
                  <div class="form-campo">
                    <label for="horario-apertura-t1">Horario de Apertura</label>
                    <input type="time" id="horario-apertura-t1">
                  </div>
                  <div class="form-campo">
                    <label for="horario-cierre-t1">Horario de Cierre</label>
                    <input type="time" id="horario-cierre-t1">
                  </div>
                </div>
              </fieldset>
              <fieldset>
                <legend>Turno Tarde</legend>
                <div class="form-grid-2">
                  <div class="form-campo">
                    <label for="horario-apertura-t2">Horario de Apertura</label>
                    <input type="time" id="horario-apertura-t2">
                  </div>
                  <div class="form-campo">
                    <label for="horario-cierre-t2">Horario de Cierre</label>
                    <input type="time" id="horario-cierre-t2">
                  </div>
                </div>
              </fieldset>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primario">Guardar Configuraci√≥n de Caja</button>
            </div>
          </form>
        </section>
        <!-- ‚úÖ FIN: NUEVA SECCI√ìN PARA GESTI√ìN DE CAJA -->
       <!-- ==================================================================== -->
<!-- SECCI√ìN: Conexi√≥n y Gesti√≥n de Balanzas Kretz                       -->
<!-- ==================================================================== -->
<section class="content-section">
  <h2>Balanzas Kretz (Wi-Fi / Bluetooth)</h2>

  <details class="tutorial">
    <summary>C√≥mo conectar una balanza Kretz</summary>
    <div class="tutorial-content">
      <ul>
        <li>Wi-Fi (TCP): configur√° la IP y puerto de la balanza (ej: 192.168.0.50:8000).</li>
        <li>Bluetooth (SPP): emparej√° en Windows y copi√° la direcci√≥n (ej: <code>00:1A:7D:DA:71:13</code>).</li>
        <li>El protocolo por defecto es <strong>Kretz Report</strong> (ASCII).</li>
      </ul>
    </div>
  </details>

  <form id="scale-config-form">
    <div class="form-grid-3">
      <div class="form-campo">
        <label>Transporte</label>
        <select id="scale-transport">
          <option value="tcp">Wi-Fi / Ethernet (TCP)</option>
          <option value="bt">Bluetooth (SPP)</option>
        </select>
      </div>

      <div class="form-campo only-tcp">
        <label>IP</label>
        <input type="text" id="scale-ip" placeholder="192.168.0.50">
      </div>

      <div class="form-campo only-tcp">
        <label>Puerto</label>
        <input type="number" id="scale-port" placeholder="8000" value="8000">
      </div>

      <div class="form-campo only-bt" style="display:none;">
        <label>Direcci√≥n BT</label>
        <input type="text" id="scale-bt-address" placeholder="00:1A:7D:DA:71:13">
      </div>

      <div class="form-campo">
        <label>Protocolo</label>
        <select id="scale-protocol">
          <option value="kretz-report">Kretz Report</option>
        </select>
      </div>

      <div class="form-campo">
        <label>Timeout (ms)</label>
        <input type="number" id="scale-timeout" value="4000">
      </div>
    </div>

    <div class="form-actions" style="gap:.5rem;">
      <button type="button" id="btn-scale-test" class="btn btn-secundario">Probar Conexi√≥n</button>
      <button type="submit" class="btn btn-primario">Guardar Configuraci√≥n</button>
    </div>
  </form>

  <hr style="margin:1rem 0;"/>

  <h3>Gesti√≥n r√°pida de PLUs</h3>
  <form id="scale-plu-form" class="inline-form" style="gap:.5rem;flex-wrap:wrap;">
    <input type="number" id="plu-code" placeholder="PLU (p.ej. 1234)" required>
    <input type="text"   id="plu-name" placeholder="Nombre (m√°x 24)" maxlength="24" required>
    <input type="number" id="plu-price" placeholder="Precio (centavos) ej: 15999" required>
    <input type="number" id="plu-tare" placeholder="Tara (gramos) ej: 0" value="0">
    <div class="form-actions" style="gap:.5rem;">
      <button type="button" id="btn-scale-upsert" class="btn btn-primario">Crear/Actualizar</button>
      <button type="button" id="btn-scale-delete" class="btn btn-danger">Eliminar</button>
    </div>
  </form>

  <!-- Debajo de <h3>Gesti√≥n r√°pida de PLUs</h3> -->
<form id="scale-plu-form" class="inline-form" style="gap:.5rem;flex-wrap:wrap;">
  <input type="number" id="plu-code" placeholder="PLU (p.ej. 1234)" required>
  <input type="text"   id="plu-name" placeholder="Nombre (m√°x 24)" maxlength="24" required>
  <input type="number" id="plu-price" placeholder="Precio (centavos) ej: 15999" required>
  <input type="number" id="plu-tare" placeholder="Tara (gramos) ej: 0" value="0">

  <!-- NUEVO: C√≥digo de barras editable -->
  <input type="text" id="plu-barcode" placeholder="C√≥digo de barras (opcional)">
  <label style="display:flex;gap:.5rem;align-items:center;">
    <input type="checkbox" id="barcode-auto" checked>
    Generar c√≥digo autom√°ticamente seg√∫n formato de balanza
  </label>
  <div id="barcode-preview" style="font-family:monospace;opacity:.85;"></div>

  <div class="form-actions" style="gap:.5rem;">
    <button type="button" id="btn-scale-upsert" class="btn btn-primario">Crear/Actualizar</button>
    <button type="button" id="btn-scale-delete" class="btn btn-danger">Eliminar</button>
  </div>
</form>


  <div class="form-actions" style="margin-top:.5rem;">
    <button type="button" id="btn-scale-sync-all" class="btn btn-warning">Sincronizar Cat√°logo Completo ‚Üí Balanza</button>
  </div>
</section>

       
        <!-- ==================================================================== -->
        <!-- SECCI√ìN SINCRONIZACI√ìN Y SUSCRIPCI√ìN                               -->
        <!-- ==================================================================== -->
        <section class="content-section">
          <h2>Sincronizaci√≥n en la Nube y Suscripci√≥n</h2>

          <details class="tutorial">
            <summary>¬øC√≥mo funciona la sincronizaci√≥n y la suscripci√≥n?</summary>
            <div class="tutorial-content">
              <p>
                La sincronizaci√≥n en la nube y las copias de seguridad forman parte de las
                <strong>funciones premium</strong> del sistema. Para utilizarlas necesit√°s una
                <strong>suscripci√≥n activa</strong>.
              </p>

              <h4>¬øQu√© incluye?</h4>
              <ul>
                <li>Respaldo autom√°tico de tus datos en la nube.</li>
                <li>Sincronizaci√≥n entre m√∫ltiples equipos/puestos.</li>
                <li>Restauraci√≥n ante fallos o p√©rdida del equipo.</li>
                <li>Acceso remoto a cat√°logos, ventas y estad√≠sticas.</li>
              </ul>

              <h4>C√≥mo activarlo (paso a paso)</h4>
              <ol>
                <li>
                  Contrat√° una suscripci√≥n en
                  <a href="https://www.sitiowebejemplo.com" target="_blank" rel="noopener">www.sitiowebejemplo.com</a>.
                </li>
                <li>
                  Vas a recibir tu <strong>Token de Licencia</strong> (tambi√©n visible en tu panel del sitio).
                </li>
                <li>
                  Peg√° el token en <em>Token de Licencia</em> y complet√° la <em>URL de la API</em>
                  (por defecto: <code>https://servidor-api-ventasimple-production.up.railway.app</code>).
                </li>
                <li>
                  Activ√° <em>Sincronizaci√≥n</em> y presion√° <em>Guardar Configuraci√≥n de Sincronizaci√≥n</em>.
                </li>
                <li>
                  El sistema validar√° la licencia y mostrar√° el <em>Estado de la Suscripci√≥n</em> debajo.
                </li>
              </ol>

              <h4>Notas importantes</h4>
              <ul>
                <li>Se requiere conexi√≥n a Internet para validar la licencia y sincronizar.</li>
                <li>Si pasan <strong>72 horas</strong> sin poder validar la suscripci√≥n, el sistema puede bloquear
                  las funciones premium hasta reconectar.</li>
                <li>El <em>Token de Licencia</em> es sensible: no lo compartas ni lo publiques.</li>
                <li>Si desactiv√°s la sincronizaci√≥n, la app sigue funcionando de forma local (sin funciones premium).
                </li>
              </ul>
            </div>
          </details>

          <form id="sync-config-form">
            <div class="form-grid-2">
              <div class="form-campo">
                <label for="license-key">Token de Licencia</label>
                <input type="text" id="license-key" placeholder="Ej: 6f1b2c8e-...." />
                <small>No compartas este token.</small>
              </div>
            </div>

            <div class="form-grid-2">
              <div class="form-campo">
                <label for="sync-api-url">URL de la API</label>
                <input type="url" id="sync-api-url" placeholder="https://tu-servidor-api.com" />
                <small>Por defecto: <code>https://servidor-api-ventasimple-production.up.railway.app</code></small>
              </div>

              <div class="module-toggle">
                <label for="sync-enabled-toggle">Activar Sincronizaci√≥n</label>
                <div class="checkbox-control">
                  <input type="checkbox" id="sync-enabled-toggle" />
                  <label for="sync-enabled-toggle"></label>
                </div>
              </div>
            </div>

            <div class="form-campo">
              <label>Estado de la Suscripci√≥n</label>
              <div id="subscription-status-display" class="status-display">
                Cargando...
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primario">
                Guardar Configuraci√≥n de Sincronizaci√≥n
              </button>
            </div>

            <p class="form-help" style="margin-top: .75rem;">
              ¬øNecesit√°s ayuda? Visit√°
              <a href="https://www.sitiowebejemplo.com" target="_blank" rel="noopener">
                www.sitiowebejemplo.com
              </a>.
            </p>
          </form>
        </section>
      </div>
    </main>
  </div>

  <!-- ==================================================================== -->
  <!-- MODALES ESTANDARIZADOS                                               -->
  <!-- ==================================================================== -->

  <!-- Modal para crear/editar EMPLEADO -->
  <div id="empleado-modal" class="modal">
    <div class="modal-content">
      <h2 id="empleado-modal-title">Nuevo Empleado</h2>
      <form id="empleado-form">
        <input type="hidden" id="empleado-id">
        <div class="form-campo">
          <label for="empleado-nombre">Nombre Completo</label>
          <input type="text" id="empleado-nombre" required>
        </div>
        <div class="form-campo">
          <label for="empleado-funcion">Funci√≥n / Puesto</label>
          <input type="text" id="empleado-funcion" placeholder="Ej: Cajero, Repositor">
        </div>
        <div class="form-campo">
          <label for="empleado-sueldo">Sueldo Mensual ($)</label>
          <input type="number" id="empleado-sueldo" step="0.01" required>
        </div>
        <div class="form-actions">
          <button type="button" id="btn-cancelar-empleado" class="btn btn-secundario">Cancelar</button>
          <button type="submit" class="btn btn-primario">Guardar Empleado</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para crear/editar Usuario -->
  <div id="user-modal" class="modal">
    <div class="modal-content">
      <h2 id="modal-title">Nuevo Usuario</h2>
      <form id="user-form">
        <input type="hidden" id="user-id" />
        <div class="form-campo">
          <label for="nombre">Nombre de Usuario</label>
          <input type="text" id="nombre" required />
        </div>
        <div class="form-campo">
          <label for="password">Contrase√±a</label>
          <input type="password" id="password" />
          <small>Dejar en blanco para no cambiar la contrase√±a existente.</small>
        </div>
        <div class="form-campo">
          <label for="rol">Rol</label>
          <select id="rol" required>
            <option value="cajero">Cajero</option>
            <option value="administrador">Administrador</option>
          </select>
        </div>
        <fieldset id="permisos-fieldset">
          <legend>Permisos de M√≥dulos (para Cajeros)</legend>
          <div id="permisos-container" class="permisos-grid"></div>
        </fieldset>
        <div class="form-actions">
          <button type="button" id="btn-cancelar" class="btn btn-secundario">Cancelar</button>
          <button type="submit" class="btn btn-primario">Guardar Usuario</button>
        </div>
      </form>
    </div>
  </div>

  <script src="../js/navbar-loader.js"></script>
  <script src="../js/admin.js"></script>
  <div id="toast-notification" class="toast"></div>
  <script src="../js/subscription.js"></script>

</body>

</html>